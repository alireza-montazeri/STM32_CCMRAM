# STM32 CCMRAM
This repository contains CubeIDE project for using CCMRAM on STM32 microcontrollers. It is specifically generated for the **STM32L476** microcontroller.

Some STM32 CPUs include two banks of memory: the standard SRAM and another bank of Core-Coupled-Memory (a.k.a. CCM), which is faster than the regular SRAM and used for DSP usage. It may be interesting to place data in this area in some cases. This section of RAM does not have access to DMA, so variables in CCMRAM can't send by DMA to other peripherals.

For this there is several possibilities, depending on the amount of memory needed by your program. In all cases you may need to manually edit the linker script file (LinkerScript.ld, except if generated by CubeMX where the name depend on the chip reference). CubeMX generated code always have linker script file named `STM32***_FLASH.ld`. In this file you can do steps below to use CCMRAM in your project.
<br/><br/>

#### 1. Checking if CCM was declared
You must first look for the MEMORY section and, if it is not present, add a line looking like
``` 
  RAM2    (xrw)    : ORIGIN = 0x10000000,   LENGTH = 32K
```
*of course you must check the address of the CCM block for each microcontroller in datasheet. this comes from a STM32L476VG chip*

#### 2. Create CCMRAM section in linker script
You must create the `.ram2` section in `STM32***_FLASH.ld` like below:
```
 /* RAM2 section */
  
  /* Used by the startup to initialize RAM2 */
  _siram2 = LOADADDR(.ram2);
  
  /* IMPORTANT NOTE!!!!
  *  If initialized variables will be placed in this section,
  *  The startup code needs to be modified to copy the init-values.
  */
  .ram2 :
  {
  	. = ALIGN(4);
  	_sram2 = .;	/* Create a global symbol at data end */
  	*(.ram2)		/* .data section */
  	*(.ram2*)		/* .data* section */
  	
  	. = ALIGN(4);
  	_eram2 = .;	/* Define a global symbol at data end. */
  }	>RAM2
  ```

  #### 3. Place uninitialized variables in CCM
  You can very simply place uninitialized variables in CCM by adding to their definition a section attribute, like, for variable `ccmram_var` declaring it by:
  ```
  int ccmram_var[1000] __attribute__((section(".ram2")));
  ```
  Yes, there is double underscores and double parentheses in this ugly syntax but to make it easy to use you can define the ugly part like below:
  ```
  #define CCMRAM __attribute__((section(".ram2")))
  ```
  So to define variable you can easily type
  ```
  int ccmram_var[1000] CCMRAM;
  ```

  #### 4. Zero-initialized and initialized variables
  To use CCMRAM for zero-initialized and initialized, you can find solution in [here](https://www.openstm32.org/Using%2BCCM%2BMemory).